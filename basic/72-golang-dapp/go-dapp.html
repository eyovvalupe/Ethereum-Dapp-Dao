<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2022-04-12 二 17:46 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>golang dapp</title>
<meta name="author" content="rzry https://github.com/rzry" />
<meta name="generator" content="Org Mode" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://taopeng.me/org-notes-style/css/notes.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">golang dapp</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org347bf02">1. 画龙点睛</a></li>
<li><a href="#org49aedab">2. 高屋建瓴</a></li>
<li><a href="#org3802d91">3. 分星掰两</a></li>
<li><a href="#org22188f3">4. 厚积薄发</a></li>
</ul>
</div>
</nav>
<div id="outline-container-org347bf02" class="outline-2">
<h2 id="org347bf02"><span class="section-number-2">1.</span> 画龙点睛</h2>
<div class="outline-text-2" id="text-1">
<pre class="example">
对于一个Web3.0的开发者,Golang的需求是很大的
很多时候需要使用Golang来和链交互操作,来完成一些请求操作.
那Golang怎么和链交互呢?
本文以BSC网络(类ETH)的Dex抢跑程序,以及抢购公开铸造NFT程序的部分代码来交互链上数据.
来看一下整体的流程是如何的.
</pre>
</div>
</div>

<div id="outline-container-org49aedab" class="outline-2">
<h2 id="org49aedab"><span class="section-number-2">2.</span> 高屋建瓴</h2>
<div class="outline-text-2" id="text-2">

<figure id="orgf2e50c4">
<img src="高屋建瓴/2022-04-12_16-21-40_height.png" alt="2022-04-12_16-21-40_height.png">

</figure>
</div>
</div>

<div id="outline-container-org3802d91" class="outline-2">
<h2 id="org3802d91"><span class="section-number-2">3.</span> 分星掰两</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li><p>
获取合约代码,或者Abi
</p>
<pre class="example">
很多链上很多swap都是使用uniswap V2的代码,比如pancake,sushi,mm...
我们直接使用uniswap的router02以及factory 就可以了,具体的代码github里面就有,也可以直接复制下面的代码
https://cronoscan.com/address/0x145677fc4d9b8f19b5d56d1820c48e0443049a30#contracts
</pre>

<figure id="orgdf22815">
<img src="分星掰两/2022-04-12_16-35-52_截屏2022-04-12 下午4.35.30.png" alt="2022-04-12_16-35-52_截屏2022-04-12 下午4.35.30.png">

</figure>
<pre class="example">
一个小技巧,很多链这个没法复制,可以点击More Options --&gt; Compare 来复制.
保存到truffle的一个文件夹.
关于truffle的使用,就不啰嗦了,可以翻看具体之前项目内的文档.
一些工具的推荐,solc-select(pip install),可以切换solc的版本
</pre>

<figure id="org0e4f6e9">
<img src="分星掰两/2022-04-12_16-39-19_截屏2022-04-12 下午4.39.07.png" alt="2022-04-12_16-39-19_截屏2022-04-12 下午4.39.07.png">

</figure>
<pre class="example">
在 contracts 文件夹 touch uniswap.sol
copy 代码进去. 修改默认的truffle-config.js版本.
如果你顺利的话应该能碰到这种版本错误的问题
</pre>

<figure id="org5fb8519">
<img src="分星掰两/2022-04-12_16-47-21_截屏2022-04-12 下午4.46.03.png" alt="2022-04-12_16-47-21_截屏2022-04-12 下午4.46.03.png">

</figure>
<pre class="example">
这个问题,你首先要确定你的npm 读的是那个 solc ,然后才能解决.
如果未在truffle项目内 npm init -f .那直接删除掉全局的npm内的solc
再使用npm install -g solc@0.6.0就可以了.
当然solc-select也可以.
下图为演示步骤
</pre>

<figure id="orgf3093c6">
<img src="分星掰两/2022-04-12_16-50-03_截屏2022-04-12 下午4.48.53.png" alt="2022-04-12_16-50-03_截屏2022-04-12 下午4.48.53.png">

</figure>

<pre class="example">
再运行图中命令,即可生成 bin 文件 . 同理生成 abi 文件
</pre>

<figure id="org7756432">
<img src="分星掰两/2022-04-12_16-51-41_截屏2022-04-12 下午4.51.34.png" alt="2022-04-12_16-51-41_截屏2022-04-12 下午4.51.34.png">

</figure>

<pre class="example">
接下来使用abigen 即可生成 go 文件 .
abigen --bin=uniswap_sol_IMeerkatRouter02.bin \
--abi=uniswap_sol_IMeerkatRouter02.abi --pkg=Store --out=router.go

那这个文件就是go 来链接链上Router合约,以及调用Router合约方法的文件
同理生成factory合约文件...
</pre>

<figure id="orgbad6368">
<img src="分星掰两/2022-04-12_16-54-31_截屏2022-04-12 下午4.53.18.png" alt="2022-04-12_16-54-31_截屏2022-04-12 下午4.53.18.png">

</figure></li>
<li><p>
使用go来与合约交互
</p>
<pre class="example">
使用一个现有的很简单的项目来讲解,此项目可以在github.com/rzry/flashDeal 找到源码
项目分层为下图.cmd 存放main.go  internal 存放主要实现.
pkg 存放了我们上一步生成的一些go的文件.

此项目是监控Swap池子余量,在池子最开始的时候抢跑
(这个失败机率很大,已经被废弃了,请勿用于主网链上.)

项目就是监控池子余量, 根据path 来发起swap的请求.
我们主要来看授权 , 以及调用.
</pre>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #51afef;">func</span> <span style="color: #c678dd;">TestFlash</span>(<span style="color: #dcaeea;">t</span> *<span style="color: #ECBE7B;">testing.T</span>) {
    <span style="color: #828282;">//</span><span style="color: #828282;">&#24314;&#31435; client &#38142;&#25509;</span>
<span style="color: #dcaeea;">ci</span>, <span style="color: #dcaeea;">err</span> := ethclient.<span style="color: #c678dd;">Dial</span>(<span style="color: #98be65;">"https://evm.cronos.org"</span>)
<span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
    <span style="color: #51afef;">return</span>
}
   <span style="color: #828282;">//</span><span style="color: #828282;">&#20351;&#29992;Erc20&#21512;&#32422;&#29983;&#25104;&#30340;go&#25991;&#20214;,&#38142;&#25509;&#36825;&#20010;token,&#33719;&#24471;Store</span>
<span style="color: #dcaeea;">pinstance</span>, <span style="color: #dcaeea;">err</span> := platform.<span style="color: #c678dd;">NewStore</span>(common.<span style="color: #c678dd;">HexToAddress</span>(<span style="color: #98be65;">"0x66e428c3f67a68878562e79A0234c1F83c20870"</span>), ci)
<span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
    <span style="color: #51afef;">return</span>
}
    <span style="color: #828282;">//</span><span style="color: #828282;">&#20351;&#29992;&#27492;Store&#26469;&#35843;&#29992;Allowance,&#26597;&#35810;&#26377;&#22810;&#23569;Approve&#25968;&#37327;</span>
<span style="color: #dcaeea;">in</span>, <span style="color: #dcaeea;">err</span> := pinstance.<span style="color: #c678dd;">Allowance</span>(<span style="color: #a9a1e1;">nil</span>, common.<span style="color: #c678dd;">HexToAddress</span>(<span style="color: #98be65;">"0x545c2f7689bd45f8c9b78b6756f13580165e6d4"</span>), common.<span style="color: #c678dd;">HexToAddress</span>(<span style="color: #98be65;">"0x145677FC4d9b8F19B5D56d1820c48e0443049a30"</span>))
<span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
    <span style="color: #51afef;">return</span>
}
t.<span style="color: #c678dd;">Logf</span>(in.<span style="color: #c678dd;">String</span>())
    <span style="color: #828282;">// </span><span style="color: #828282;">&#36825;&#23601;&#26159;&#26368;&#31616;&#21333;&#30340;&#19968;&#20010;&#20132;&#20114;,&#27809;&#26377;&#25480;&#26435;,&#19968;&#20010;&#21482;&#26159;view&#30340;&#35831;&#27714;</span>
}
</pre>
</div>
<div class="org-src-container">
<pre class="src src-go"><span style="color: #828282;">//</span><span style="color: #828282;">&#21024;&#38500;&#19968;&#20123;&#26080;&#20851;&#20195;&#30721;.&#20250;&#22312;goroutine &#33719;&#21462;&#21040;&#20449;&#21495;&#21518;,&#24320;&#22987;&#25191;&#34892;case</span>
<span style="color: #51afef;">for</span> {
  <span style="color: #51afef;">select</span> {
    <span style="color: #51afef;">case</span> &lt;-FasterDone:
      <span style="color: #828282;">// </span><span style="color: #828282;">&#39318;&#20808;&#33719;&#21462;&#21040;auth</span>
        <span style="color: #dcaeea;">auth</span>, <span style="color: #dcaeea;">err</span> := <span style="color: #c678dd;">Auth</span>(opt)
        <span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
            <span style="color: #51afef;">return</span>
        }
        <span style="color: #828282;">//</span><span style="color: #828282;">&#22312;&#36825;&#37324;&#35843;&#29992;router&#30340; swapExactTokensFroTokens,&#32780;&#31532;&#19968;&#20010;&#21442;&#25968;&#23601;&#26159;auth</span>
        <span style="color: #828282;">// </span><span style="color: #828282;">&#22312;&#19978;&#38754;view&#30340;&#35831;&#27714;&#20013;,&#25105;&#20204;&#21487;&#20197;&#30452;&#25509;&#20256;&#31354;,&#20294;&#26159;&#22914;&#26524;&#35201;&#20184;Gas,&#23601;&#35201;&#20174;&#27492;&#22320;&#22336;&#25187;&#38065;.</span>
        <span style="color: #dcaeea;">tx</span>, <span style="color: #dcaeea;">err</span> := opt.RouterInstance.<span style="color: #c678dd;">SwapExactTokensForTokens</span>(auth,
            pkg.<span style="color: #c678dd;">ToEthers</span>(opt.BuyAmount, opt.Decimal).<span style="color: #c678dd;">BigInt</span>(),
            big.<span style="color: #c678dd;">NewInt</span>(0),
            opt.Path,
            auth.From,
            big.<span style="color: #c678dd;">NewInt</span>(time.<span style="color: #c678dd;">Now</span>().<span style="color: #c678dd;">Unix</span>()+20*60))
        <span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
            <span style="color: #51afef;">return</span>
        }
</pre>
</div>
<div class="org-src-container">
<pre class="src src-go">  <span style="color: #51afef;">func</span> <span style="color: #c678dd;">Auth</span>(<span style="color: #dcaeea;">opt</span> *<span style="color: #ECBE7B;">options.Config</span>) (<span style="color: #dcaeea;">auth</span> *<span style="color: #ECBE7B;">bind.TransactOpts</span>, <span style="color: #dcaeea;">err</span> <span style="color: #ECBE7B;">error</span>) {
    <span style="color: #828282;">//</span><span style="color: #828282;">&#33719;&#21462;Gas</span>
    <span style="color: #dcaeea;">gas</span>, <span style="color: #dcaeea;">err</span> := opt.Ci.<span style="color: #c678dd;">SuggestGasPrice</span>(context.<span style="color: #c678dd;">Background</span>())
    <span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
        <span style="color: #51afef;">return</span>
    }
    <span style="color: #828282;">//</span><span style="color: #828282;">&#33719;&#21462;chainId</span>
    <span style="color: #dcaeea;">chainId</span>, <span style="color: #dcaeea;">err</span> := opt.Ci.<span style="color: #c678dd;">ChainID</span>(context.<span style="color: #c678dd;">Background</span>())
    <span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
        <span style="color: #51afef;">return</span>
    }
    <span style="color: #828282;">//</span><span style="color: #828282;">&#26681;&#25454;&#31169;&#38053;&#33719;&#21462;PrivateKey</span>
    <span style="color: #dcaeea;">privateKey</span>, <span style="color: #dcaeea;">err</span> := crypto.<span style="color: #c678dd;">HexToECDSA</span>(opt.PrivateKey)
    <span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
        <span style="color: #51afef;">return</span>
    }
    <span style="color: #828282;">//</span><span style="color: #828282;">&#33719;&#21462;&#21040;auth</span>
    auth, err = bind.<span style="color: #c678dd;">NewKeyedTransactorWithChainID</span>(privateKey, chainId)
    <span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
        <span style="color: #51afef;">return</span>
    }
    <span style="color: #828282;">//</span><span style="color: #828282;">&#33719;&#21462;&#21040;&#20844;&#38053;</span>
    <span style="color: #dcaeea;">publicKeyECDSA</span>, <span style="color: #dcaeea;">ok</span> := privateKey.<span style="color: #c678dd;">Public</span>().(*<span style="color: #ECBE7B;">ecdsa.PublicKey</span>)
    <span style="color: #51afef;">if</span> <span style="color: #51afef; font-weight: bold;">!</span>ok {
        <span style="color: #51afef;">return</span>
    }
    <span style="color: #828282;">//</span><span style="color: #828282;">&#26681;&#25454;&#20844;&#38053;&#33719;&#21462;from</span>
    <span style="color: #dcaeea;">fromAddress</span> := crypto.<span style="color: #c678dd;">PubkeyToAddress</span>(*publicKeyECDSA)
    <span style="color: #828282;">//</span><span style="color: #828282;">&#33719;&#21462;from&#30340;nonce</span>
    <span style="color: #dcaeea;">nonce</span>, <span style="color: #dcaeea;">err</span> := opt.Ci.<span style="color: #c678dd;">PendingNonceAt</span>(context.<span style="color: #c678dd;">Background</span>(), fromAddress)
    <span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
        <span style="color: #51afef;">return</span>
    }
    <span style="color: #828282;">//</span><span style="color: #828282;">&#20462;&#25913;nonce</span>
    auth.Nonce = big.<span style="color: #c678dd;">NewInt</span>(<span style="color: #c678dd;">int64</span>(nonce))
    <span style="color: #828282;">//</span><span style="color: #828282;">&#20462;&#25913; msg.value</span>
    auth.Value = big.<span style="color: #c678dd;">NewInt</span>(0) <span style="color: #828282;">// </span><span style="color: #828282;">in wei</span>
    <span style="color: #828282;">//</span><span style="color: #828282;">&#20462;&#25913; gaslimit</span>
    auth.GasLimit = <span style="color: #c678dd;">uint64</span>(opt.GasLimit) <span style="color: #828282;">// </span><span style="color: #828282;">in units</span>
    <span style="color: #828282;">// </span><span style="color: #828282;">&#20462;&#25913;GasPrice</span>
    auth.GasPrice = gas
    <span style="color: #51afef;">return</span>
}
</pre>
</div>
<pre class="example">
有了Auth,就可以请求Swap的接口了,有时候有一些需求,比如项目方需要给很多地址空投
那使用go的线程池,你只用维护一个全局唯一累加的nonce,就可以很快的将所有交易全发出.
(不过这个也要谨慎哦...)
</pre></li>

<li><p>
使用go 来和Abi 交互
</p>
<pre class="example">
前几天有小伙伴在群内问,如果没有开源的合约怎么调用之类的问题.
恰好之前的写抢购公开Nft的脚本的时候有一部分代码重合.
场景是要在很快的时间来根据Abi获取到Go能调用的函数.
然后拼凑参数,监控目前请求的Gas,排序后,发起一笔交易.
这部分代码比较多,我们只关注发起交易
</pre>

<div class="org-src-container">
<pre class="src src-go"><span style="color: #828282;">//</span><span style="color: #828282;">&#20063;&#26159;&#21024;&#38500;&#25481;&#26080;&#20851;&#32039;&#35201;&#30340;&#20195;&#30721;&#21518;&#30340;&#32467;&#26524;,&#24182;&#19981;&#20855;&#22791;&#36816;&#34892;&#33021;&#21147;.</span>
    <span style="color: #51afef;">func</span> (<span style="color: #dcaeea;">d</span> *<span style="color: #ECBE7B;">Dynamic</span>) <span style="color: #c678dd;">NewTx</span>(<span style="color: #dcaeea;">key</span> <span style="color: #ECBE7B;">string</span>, <span style="color: #dcaeea;">new</span> <span style="color: #ECBE7B;">bool</span>) (<span style="color: #dcaeea;">txHash</span> *<span style="color: #ECBE7B;">types.Transaction</span>, <span style="color: #dcaeea;">err</span> <span style="color: #ECBE7B;">error</span>) {
    <span style="color: #828282;">// </span><span style="color: #828282;">DealAbi &#20989;&#25968;&#23601;&#26159;&#22312;&#26681;&#25454;&#21512;&#32422;&#22320;&#22336;&#25343;&#21040;ABi&#21518;&#33258;&#21160;&#25130;&#21462;&#25105;&#25152;&#38656;&#35201;&#30340;&#37027;&#19968;&#27573;,&#28982;&#21518;&#36820;&#22238;&#25340;&#20945;&#30340;data</span>
    <span style="color: #828282;">// </span><span style="color: #828282;">&#20855;&#20307;&#30340;&#23454;&#29616;,&#25105;&#20250;&#36148;&#22312;&#19979;&#38754;</span>
    <span style="color: #dcaeea;">_</span>, <span style="color: #dcaeea;">data</span> := d.<span style="color: #c678dd;">DealAbi</span>()
    <span style="color: #828282;">// </span><span style="color: #828282;">&#33719;&#21462;ChainId</span>
    <span style="color: #dcaeea;">chain</span>, <span style="color: #dcaeea;">err</span> := d.<span style="color: #c678dd;">GetChain</span>()
    <span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
        <span style="color: #51afef;">return</span>
    }
    <span style="color: #828282;">//</span><span style="color: #828282;">&#33719;&#21462;nonce</span>
    <span style="color: #dcaeea;">nonce</span>, <span style="color: #dcaeea;">err</span> := d.<span style="color: #c678dd;">GetNonce</span>(new, key)
    <span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
        <span style="color: #51afef;">return</span>
    }
    <span style="color: #828282;">// </span><span style="color: #828282;">&#35843;&#29992;Eth &#24211; NewTx &#26469;&#21457;&#36215;&#19968;&#31508;&#26032;&#30340;&#20132;&#26131;</span>
    <span style="color: #dcaeea;">tx</span> := types.<span style="color: #c678dd;">NewTx</span>(&amp;<span style="color: #ECBE7B;">types.DynamicFeeTx</span>{
        <span style="color: #a9a1e1;">ChainID</span>:   chain,
        <span style="color: #a9a1e1;">Nonce</span>:     nonce,
        <span style="color: #828282;">// </span><span style="color: #828282;">utils.toEthers &#26159;&#23558;string&#36716;decimal&#25193;&#22823;9&#20301;</span>
        <span style="color: #a9a1e1;">GasTipCap</span>: utils.<span style="color: #c678dd;">ToEthers</span>(d.Gas, 9).<span style="color: #c678dd;">BigInt</span>(),
        <span style="color: #a9a1e1;">GasFeeCap</span>: utils.<span style="color: #c678dd;">ToEthers</span>(d.Gas, 9).<span style="color: #c678dd;">BigInt</span>(),
        <span style="color: #a9a1e1;">Gas</span>:       <span style="color: #c678dd;">uint64</span>(2150000),
        <span style="color: #a9a1e1;">To</span>:        d.<span style="color: #c678dd;">GetTo</span>(),
        <span style="color: #a9a1e1;">Value</span>:     utils.<span style="color: #c678dd;">ToEthers</span>(d.Value, 18).<span style="color: #c678dd;">BigInt</span>(),
        <span style="color: #a9a1e1;">Data</span>:      data,
    })
    <span style="color: #828282;">//</span><span style="color: #828282;">&#33719;&#21462;&#31169;&#38053;</span>
    <span style="color: #dcaeea;">private</span>, <span style="color: #dcaeea;">err</span> := d.<span style="color: #c678dd;">getPrivate</span>(key)
    <span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
        <span style="color: #51afef;">return</span>
    }
    <span style="color: #828282;">// </span><span style="color: #828282;">&#31614;&#21517;</span>
    tx, err = types.<span style="color: #c678dd;">SignTx</span>(tx, d.<span style="color: #c678dd;">Getsigner</span>(chain), private)
    <span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
        <span style="color: #51afef;">return</span>
    }
    <span style="color: #828282;">// </span><span style="color: #828282;">&#21457;&#36865;&#21040;&#20869;&#23384;&#27744;&#20013;</span>
    <span style="color: #51afef;">if</span> err = d.Cc.<span style="color: #c678dd;">SendTransaction</span>(context.<span style="color: #c678dd;">Background</span>(), tx); err != <span style="color: #a9a1e1;">nil</span> {
        <span style="color: #51afef;">return</span>
    }
    <span style="color: #51afef;">return</span> tx, err
}
</pre>
</div>
<div class="org-src-container">
<pre class="src src-go">    <span style="color: #828282;">//</span><span style="color: #828282;">&#27492;&#20026;&#22788;&#29702; abi&#30340;&#20989;&#25968;</span>
    <span style="color: #51afef;">func</span> <span style="color: #c678dd;">dealAbi</span>(<span style="color: #dcaeea;">abis</span> <span style="color: #ECBE7B;">string</span>, <span style="color: #dcaeea;">inputs</span> []<span style="color: #ECBE7B;">string</span>) (<span style="color: #dcaeea;">method</span> <span style="color: #ECBE7B;">abi.Method</span>, <span style="color: #dcaeea;">data</span> []<span style="color: #ECBE7B;">byte</span>) {
       <span style="color: #828282;">//</span><span style="color: #828282;">&#23450;&#20041;pack&#30340;&#25968;&#25454;&#31867;&#22411;</span>
       <span style="color: #dcaeea;">u256</span>, <span style="color: #dcaeea;">_</span> := abi.<span style="color: #c678dd;">NewType</span>(<span style="color: #98be65;">"uint256"</span>, <span style="color: #98be65;">""</span>, <span style="color: #a9a1e1;">nil</span>)
       <span style="color: #dcaeea;">u8</span>, <span style="color: #dcaeea;">_</span> := abi.<span style="color: #c678dd;">NewType</span>(<span style="color: #98be65;">"u8"</span>, <span style="color: #98be65;">""</span>, <span style="color: #a9a1e1;">nil</span>)
       <span style="color: #dcaeea;">addr</span>, <span style="color: #dcaeea;">_</span> := abi.<span style="color: #c678dd;">NewType</span>(<span style="color: #98be65;">"address"</span>, <span style="color: #98be65;">""</span>, <span style="color: #a9a1e1;">nil</span>)
       <span style="color: #dcaeea;">byteslic</span>, <span style="color: #dcaeea;">_</span> := abi.<span style="color: #c678dd;">NewType</span>(<span style="color: #98be65;">"bytes32[]"</span>, <span style="color: #98be65;">""</span>, <span style="color: #a9a1e1;">nil</span>)
       <span style="color: #dcaeea;">newType</span>, <span style="color: #dcaeea;">_</span> := abi.<span style="color: #c678dd;">NewType</span>(<span style="color: #98be65;">"bytes"</span>, <span style="color: #98be65;">""</span>, <span style="color: #a9a1e1;">nil</span>)
       <span style="color: #828282;">//</span><span style="color: #828282;">&#23558;string &#25353; " &#20998;&#21106;</span>
       <span style="color: #dcaeea;">x</span> := strings.<span style="color: #c678dd;">Split</span>(abis, <span style="color: #98be65;">"\""</span>)
       <span style="color: #51afef;">var</span> (
           <span style="color: #dcaeea;">m</span>      <span style="color: #ECBE7B;">string</span>
           <span style="color: #dcaeea;">params</span> []<span style="color: #ECBE7B;">string</span>
           <span style="color: #dcaeea;">ispay</span>  <span style="color: #ECBE7B;">bool</span>
       )
       <span style="color: #51afef;">for</span> <span style="color: #dcaeea;">k</span>, <span style="color: #dcaeea;">v</span> := <span style="color: #51afef;">range</span> x {
           <span style="color: #51afef;">if</span> v == <span style="color: #98be65;">"internalType"</span> {
               params = <span style="color: #c678dd;">append</span>(params, x[k+2])
               <span style="color: #51afef;">continue</span>
           }
           <span style="color: #51afef;">if</span> v == <span style="color: #98be65;">"name"</span> {
               m = x[k+2]
               <span style="color: #51afef;">continue</span>
           }
           <span style="color: #51afef;">if</span> v == <span style="color: #98be65;">"stateMutability"</span> &amp;&amp; x[k+2] == <span style="color: #98be65;">"payable"</span> {
               ispay = <span style="color: #a9a1e1;">true</span>
           }
       }
       <span style="color: #51afef;">if</span> <span style="color: #c678dd;">len</span>(m) == 0 {
           <span style="color: #51afef;">return</span>
       }
       <span style="color: #51afef;">if</span> <span style="color: #c678dd;">len</span>(params) != <span style="color: #c678dd;">len</span>(inputs) {
           <span style="color: #51afef;">return</span>
       }
       <span style="color: #828282;">// </span><span style="color: #828282;">&#19968;&#39039;&#36941;&#21382;&#21518;&#33719;&#24471;&#20102;&#19968;&#20010;params &#20195;&#34920;&#26377;&#22810;&#23569;&#20010;&#21442;&#25968;</span>
       <span style="color: #51afef;">var</span> <span style="color: #dcaeea;">input</span> []<span style="color: #ECBE7B;">abi.Argument</span>
       <span style="color: #828282;">// </span><span style="color: #828282;">&#36941;&#21382;&#25152;&#26377;&#21442;&#25968;&#21518; append&#21040; &#25968;&#32452;&#20013;</span>
       <span style="color: #51afef;">var</span> <span style="color: #dcaeea;">packinput</span> []<span style="color: #51afef;">interface</span>{}
       <span style="color: #51afef;">for</span> <span style="color: #dcaeea;">k</span>, <span style="color: #dcaeea;">param</span> := <span style="color: #51afef;">range</span> params {
           <span style="color: #51afef;">switch</span> param {
           <span style="color: #51afef;">case</span> <span style="color: #98be65;">"uint256"</span>:
               input = <span style="color: #c678dd;">append</span>(input, <span style="color: #ECBE7B;">abi.Argument</span>{
                   <span style="color: #a9a1e1;">Type</span>: u256,
               })
               <span style="color: #dcaeea;">d</span>, <span style="color: #dcaeea;">err</span> := decimal.<span style="color: #c678dd;">NewFromString</span>(inputs[k])
               <span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
                   <span style="color: #51afef;">return</span>
               }
               packinput = <span style="color: #c678dd;">append</span>(packinput, d.<span style="color: #c678dd;">BigInt</span>())
           <span style="color: #51afef;">case</span> <span style="color: #98be65;">"uint8"</span>:
               input = <span style="color: #c678dd;">append</span>(input, <span style="color: #ECBE7B;">abi.Argument</span>{
                   <span style="color: #a9a1e1;">Type</span>: u8,
               })
               <span style="color: #dcaeea;">d</span>, <span style="color: #dcaeea;">err</span> := decimal.<span style="color: #c678dd;">NewFromString</span>(inputs[k])
               <span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
                   <span style="color: #51afef;">return</span>
               }
               packinput = <span style="color: #c678dd;">append</span>(packinput, d.<span style="color: #c678dd;">BigInt</span>())
           <span style="color: #51afef;">case</span> <span style="color: #98be65;">"address"</span>:
               input = <span style="color: #c678dd;">append</span>(input, <span style="color: #ECBE7B;">abi.Argument</span>{
                   <span style="color: #a9a1e1;">Type</span>: addr,
               })
               packinput = <span style="color: #c678dd;">append</span>(packinput, common.<span style="color: #c678dd;">HexToAddress</span>(inputs[k]))
           <span style="color: #51afef;">case</span> <span style="color: #98be65;">"bytes32[]"</span>:
               input = <span style="color: #c678dd;">append</span>(input, <span style="color: #ECBE7B;">abi.Argument</span>{
                   <span style="color: #a9a1e1;">Type</span>: byteslic,
               })
               packinput = <span style="color: #c678dd;">append</span>(packinput, inputs[k])
           <span style="color: #51afef;">case</span> <span style="color: #98be65;">"bytes"</span>:
               input = <span style="color: #c678dd;">append</span>(input, <span style="color: #ECBE7B;">abi.Argument</span>{
                   <span style="color: #a9a1e1;">Type</span>: newType,
               })
               packinput = <span style="color: #c678dd;">append</span>(packinput, inputs[k])
           }
       }
       <span style="color: #828282;">// </span><span style="color: #828282;">&#35843;&#29992;NewMethod &#20989;&#25968;, &#26469; &#26500;&#24314;&#25105;&#20204;&#35831;&#27714;&#30340;&#20989;&#25968;.</span>
       method = abi.<span style="color: #c678dd;">NewMethod</span>(m, m, abi.Function, <span style="color: #98be65;">""</span>, <span style="color: #a9a1e1;">false</span>, ispay, input, <span style="color: #a9a1e1;">nil</span>)
       <span style="color: #828282;">// </span><span style="color: #828282;">&#20877;&#23558;inpit&#25968;&#32452; pack&#36215;&#26469;</span>
       <span style="color: #dcaeea;">data</span>, <span style="color: #dcaeea;">err</span> := method.Inputs.<span style="color: #c678dd;">Pack</span>(packinput...)
       <span style="color: #51afef;">if</span> err != <span style="color: #a9a1e1;">nil</span> {
           <span style="color: #51afef;">return</span>
       }
       <span style="color: #828282;">//</span><span style="color: #828282;">&#20877;&#23558;Method.Sig&#37096;&#20998;&#20110; data&#25340;&#36215;&#26469;,&#23601;&#26159;&#25105;&#20204;newTx&#26102;&#20505;&#30340;data&#20102;</span>
       data = <span style="color: #c678dd;">bytesCombine</span>(crypto.<span style="color: #c678dd;">Keccak256</span>([]<span style="color: #c678dd;">byte</span>(method.Sig))[:4], data)
       <span style="color: #51afef;">return</span>
   }
<span style="color: #51afef;">func</span> <span style="color: #c678dd;">bytesCombine</span>(<span style="color: #dcaeea;">b</span> ...[]<span style="color: #ECBE7B;">byte</span>) []<span style="color: #ECBE7B;">byte</span> {
     <span style="color: #dcaeea;">length</span> := <span style="color: #c678dd;">len</span>(b)
     <span style="color: #dcaeea;">s</span> := <span style="color: #c678dd;">make</span>([][]<span style="color: #ECBE7B;">byte</span>, length)
     <span style="color: #51afef;">for</span> <span style="color: #dcaeea;">index</span> := 0; index &lt; length; index++ {
       s[index] = b[index]
     }
     <span style="color: #dcaeea;">sep</span> := []<span style="color: #c678dd;">byte</span>(<span style="color: #98be65;">""</span>)
     <span style="color: #51afef;">return</span> bytes.<span style="color: #c678dd;">Join</span>(s, sep)
 }
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org22188f3" class="outline-2">
<h2 id="org22188f3"><span class="section-number-2">4.</span> 厚积薄发</h2>
<div class="outline-text-2" id="text-4">
<pre class="example">
在可以使用go 来调用合约后,可以在链下进行很多操作.
比如三明治机器人,闪电贷机器人,抢购Nft,等等都可以操作.
但是链下数据对比链上,以及每条链内存池,以及上链时间的变化都各有千秋.
路漫漫其修远兮.吾将上下而求索.

附一张成功的图
</pre>


<figure id="org7b4f12b">
<img src="厚积薄发/2022-04-12_17-44-48_截屏2022-04-12 下午5.44.36.png" alt="2022-04-12_17-44-48_截屏2022-04-12 下午5.44.36.png">

</figure>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2022-04-12</p>
<p class="author">Author: rzry <a href="https://github.com/rzry">https://github.com/rzry</a></p>
<p class="date">Created: 2022-04-12 二 17:46</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
